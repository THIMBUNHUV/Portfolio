{% extends "base.html" %}

{% block title %}Experience{% endblock %}

{% block content %}
<section class="experience-section">
    <div class="container">
        <h1 class="page-title">Experience</h1>
        <p class="page-subtitle">Work, training, and volunteer experiences</p>

        <div class="experience-content" id="experience-container">
            <!-- Experiences will be loaded here via API -->
        </div>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', async function() {
    const container = document.getElementById("experience-container");

    try {
        const res = await fetch("/api/experience");
        const data = await res.json();

        // Group by type
        const grouped = { internship: [], job: [], volunteer: [] };
        data.forEach(exp => {
            if (grouped[exp.type]) grouped[exp.type].push(exp);
        });

        for (const [type, items] of Object.entries(grouped)) {
            if (items.length === 0) continue;

            const categoryDiv = document.createElement("div");
            categoryDiv.className = "exp-category active";
            categoryDiv.id = type;

            const timelineDiv = document.createElement("div");
            timelineDiv.className = "experience-timeline";

            items.forEach(exp => {
                const itemDiv = document.createElement("div");
                itemDiv.className = "timeline-item";
                itemDiv.innerHTML = `
                    <div class="timeline-date">${exp.start_date} - ${exp.end_date}</div>
                    <div class="timeline-content">
                        <div class="experience-card">
                            <div class="exp-header">
                                <h3>${exp.title}</h3>
                                <span class="exp-company">${exp.company}</span>
                            </div>
                            <div class="exp-details">
                                <div class="exp-location">
                                    <i class="fas fa-map-marker-alt"></i> ${exp.location || ""}
                                </div>
                                <div class="exp-duration">
                                    <i class="fas fa-calendar-alt"></i> ${exp.start_date} - ${exp.end_date}
                                </div>
                            </div>
                            <div class="exp-description">
                                <p>${exp.description}</p>
                            </div>
                        </div>
                    </div>
                `;
                timelineDiv.appendChild(itemDiv);
            });

            categoryDiv.appendChild(timelineDiv);
            container.appendChild(categoryDiv);
        }

    } catch (err) {
        container.innerHTML = "<p>Failed to load experiences.</p>";
        console.error(err);
    }
});
</script>
{% endblock %}
